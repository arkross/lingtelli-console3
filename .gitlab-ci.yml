image: python:3.6

services:
  - mysql:latest

variables:
  MYSQL_DATABASE: console
  MYSQL_USER: superuer
  MYSQL_PASSWORD: pass1234
  MYSQL_ROOT_PASSWORD: pass1234

stages:
  - build
  - test

build_env:
  stage: build
  script:
    - cd server
    - sh -c "$(curl -fsSL https://raw.githubusercontent.com/Linuxbrew/install/master/install.sh)"
    - test -d ~/.linuxbrew && eval $(~/.linuxbrew/bin/brew shellenv)
    - test -d /home/linuxbrew/.linuxbrew && eval $(/home/linuxbrew/.linuxbrew/bin/brew shellenv)
    - test -r ~/.bash_profile && echo "eval \$($(brew --prefix)/bin/brew shellenv)" >>~/.bash_profile
    - echo "eval \$($(brew --prefix)/bin/brew shellenv)" >>~/.profile
    - brew install pipenv
    - pipenv --python 3.6
    - pipenv install -r requirements.txt

test_backend:
  stage: test
  script:
    - cd server
    - pipenv shell
    - python manage.py test
